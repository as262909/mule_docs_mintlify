openapi: 3.0.3
info:
  title: MuleSoft API Manager API
  description: |
    The MuleSoft API Manager API allows you to programmatically manage API instances,
    deployments, and policies within the Anypoint Platform. Use this API to create and
    configure API instances, deploy proxies, and apply governance policies across your
    organization's environments.
  version: "1.0.0"
  contact:
    name: MuleSoft Support
    url: https://help.mulesoft.com
  license:
    name: MuleSoft EULA
    url: https://www.mulesoft.com/legal/terms/enterprise

servers:
  - url: https://anypoint.mulesoft.com/apimanager/api/v1
    description: Anypoint Platform (US control plane)
  - url: https://eu1.anypoint.mulesoft.com/apimanager/api/v1
    description: Anypoint Platform (EU control plane)

security:
  - bearerAuth: []

tags:
  - name: Instances
    description: Manage API instances in an environment.
  - name: Deployments
    description: Deploy API proxies to runtime targets.
  - name: Policies
    description: Apply and manage policies on API instances.

paths:
  /organizations/{orgId}/environments/{envId}/apis:
    post:
      tags:
        - Instances
      summary: Create an API instance
      description: |
        Creates a new API instance in the specified organization and environment.
        The instance is created in an `unregistered` state and must be deployed
        separately to begin handling traffic.
      operationId: createApiInstance
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateApiInstanceRequest"
            example:
              spec:
                groupId: "e8a7b5c2-93d1-4f6a-b2e0-1a4d5f8c9e3b"
                assetId: "customer-api"
                version: "1.0.0"
              endpoint:
                type: "http"
                uri: "https://backend.example.com/api/v1"
                proxyUri: "https://proxy.example.com/customer/v1"
                isCloudHub: false
                referencesUserDomain: false
                responseTimeout: 15000
              technology: "mule4"
              instanceLabel: "Customer API v1 - Production"
      responses:
        "201":
          description: API instance created successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiInstance"
              example:
                id: 19847562
                instanceLabel: "Customer API v1 - Production"
                technology: "mule4"
                assetId: "customer-api"
                assetVersion: "1.0.0"
                productVersion: "v1"
                environmentId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                endpoint:
                  type: "http"
                  uri: "https://backend.example.com/api/v1"
                  proxyUri: "https://proxy.example.com/customer/v1"
                  isCloudHub: false
                  referencesUserDomain: false
                  responseTimeout: 15000
                status: "unregistered"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    get:
      tags:
        - Instances
      summary: List API instances
      description: |
        Retrieves a paginated list of API instances in the specified organization
        and environment. Use query parameters to filter and paginate results.
      operationId: listApiInstances
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
        - name: query
          in: query
          description: Search term to filter API instances by name, asset ID, or label.
          required: false
          schema:
            type: string
          example: "customer"
        - name: offset
          in: query
          description: Number of results to skip for pagination.
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
        - name: limit
          in: query
          description: Maximum number of results to return.
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          example: 25
      responses:
        "200":
          description: A paginated list of API instances.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiInstanceList"
              example:
                assets:
                  - id: 19847562
                    instanceLabel: "Customer API v1 - Production"
                    assetId: "customer-api"
                    assetVersion: "1.0.0"
                    technology: "mule4"
                    status: "active"
                  - id: 19847563
                    instanceLabel: "Order API v2 - Production"
                    assetId: "order-api"
                    assetVersion: "2.1.0"
                    technology: "flexGateway"
                    status: "active"
                  - id: 19847564
                    instanceLabel: "Inventory API v1 - Staging"
                    assetId: "inventory-api"
                    assetVersion: "1.3.2"
                    technology: "mule3"
                    status: "unregistered"
                total: 3
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /organizations/{orgId}/environments/{envId}/apis/{instanceId}:
    get:
      tags:
        - Instances
      summary: Get an API instance
      description: |
        Retrieves the full details of a specific API instance, including its
        endpoint configuration, technology, and current status.
      operationId: getApiInstance
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
        - $ref: "#/components/parameters/instanceId"
      responses:
        "200":
          description: Full API instance details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiInstance"
              example:
                id: 19847562
                instanceLabel: "Customer API v1 - Production"
                technology: "mule4"
                assetId: "customer-api"
                assetVersion: "1.0.0"
                productVersion: "v1"
                environmentId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                endpoint:
                  type: "http"
                  uri: "https://backend.example.com/api/v1"
                  proxyUri: "https://proxy.example.com/customer/v1"
                  isCloudHub: false
                  referencesUserDomain: false
                  responseTimeout: 15000
                status: "active"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      tags:
        - Instances
      summary: Delete an API instance
      description: |
        Permanently deletes an API instance. This action removes the instance,
        its associated deployments, and any applied policies. This operation
        cannot be undone.
      operationId: deleteApiInstance
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
        - $ref: "#/components/parameters/instanceId"
      responses:
        "204":
          description: API instance deleted successfully. No content returned.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /organizations/{orgId}/environments/{envId}/apis/{instanceId}/deployments:
    post:
      tags:
        - Deployments
      summary: Deploy an API proxy
      description: |
        Deploys an API proxy for the specified API instance to a target runtime.
        The deployment target can be CloudHub (CH) or a Hybrid (HY) runtime.
        The gateway version must match a supported Mule runtime version.
      operationId: deployApiProxy
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
        - $ref: "#/components/parameters/instanceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeployProxyRequest"
            example:
              type: "CH"
              gatewayVersion: "4.6.0"
              targetId: "d4e5f6a7-b8c9-0123-d456-e7f8a9b0c1d2"
              environmentId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      responses:
        "201":
          description: Proxy deployment initiated successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Deployment"
              example:
                id: 3048751
                type: "CH"
                gatewayVersion: "4.6.0"
                targetId: "d4e5f6a7-b8c9-0123-d456-e7f8a9b0c1d2"
                environmentId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                applicationName: "customer-api-v1-proxy"
                status: "deploying"
                updatedDate: "2026-02-27T14:30:00.000Z"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Conflict. A deployment already exists or is in progress.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                status: 409
                title: "Conflict"
                detail: "A deployment is already in progress for this API instance."

  /organizations/{orgId}/environments/{envId}/apis/{instanceId}/policies:
    post:
      tags:
        - Policies
      summary: Apply a policy to an API instance
      description: |
        Applies a governance policy to the specified API instance. Policies
        enforce rules such as rate limiting, authentication, IP allowlisting,
        and more. The policy is identified by its Exchange asset coordinates
        (groupId, assetId, assetVersion).
      operationId: applyPolicy
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
        - $ref: "#/components/parameters/instanceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApplyPolicyRequest"
            example:
              configurationData:
                rateLimits:
                  - maximumRequests: 100
                    timePeriodInMilliseconds: 60000
                clusterizable: true
                exposeHeaders: true
              pointcutData: null
              assetId: "rate-limiting"
              assetVersion: "1.4.0"
              groupId: "68ef9520-24e9-4cf2-b2f5-620025690913"
      responses:
        "201":
          description: Policy applied successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Policy"
              example:
                id: 982341
                assetId: "rate-limiting"
                assetVersion: "1.4.0"
                configurationData:
                  rateLimits:
                    - maximumRequests: 100
                      timePeriodInMilliseconds: 60000
                  clusterizable: true
                  exposeHeaders: true
                order: 1
                disabled: false
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Conflict. This policy is already applied to the API instance.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                status: 409
                title: "Conflict"
                detail: "Policy 'rate-limiting' version '1.4.0' is already applied to this API instance."

    get:
      tags:
        - Policies
      summary: List policies applied to an API instance
      description: |
        Retrieves all policies currently applied to the specified API instance.
        Policies are returned in their execution order.
      operationId: listPolicies
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
        - $ref: "#/components/parameters/instanceId"
      responses:
        "200":
          description: A list of policies applied to the API instance.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PolicyList"
              example:
                policies:
                  - id: 982341
                    assetId: "rate-limiting"
                    assetVersion: "1.4.0"
                    order: 1
                    disabled: false
                    configurationData:
                      rateLimits:
                        - maximumRequests: 100
                          timePeriodInMilliseconds: 60000
                      clusterizable: true
                      exposeHeaders: true
                  - id: 982342
                    assetId: "client-id-enforcement"
                    assetVersion: "1.3.0"
                    order: 2
                    disabled: false
                    configurationData:
                      credentialsOriginHasHttpBasicAuthenticationHeader: "customExpression"
                      clientIdExpression: "#[attributes.headers['client_id']]"
                      clientSecretExpression: "#[attributes.headers['client_secret']]"
                  - id: 982343
                    assetId: "ip-allowlist"
                    assetVersion: "1.2.0"
                    order: 3
                    disabled: true
                    configurationData:
                      ips:
                        - "10.0.0.0/8"
                        - "172.16.0.0/12"
                        - "192.168.1.100"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /organizations/{orgId}/environments/{envId}/apis/{instanceId}/policies/{policyId}:
    delete:
      tags:
        - Policies
      summary: Remove a policy from an API instance
      description: |
        Removes a specific policy from the API instance. Once removed, the policy
        rules will no longer be enforced on incoming requests. The remaining
        policies retain their relative execution order.
      operationId: removePolicy
      parameters:
        - $ref: "#/components/parameters/orgId"
        - $ref: "#/components/parameters/envId"
        - $ref: "#/components/parameters/instanceId"
        - $ref: "#/components/parameters/policyId"
      responses:
        "204":
          description: Policy removed successfully. No content returned.
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Obtain a bearer token by authenticating with the Anypoint Platform
        Identity API (`POST /accounts/login`). Pass the `access_token` value
        in the `Authorization` header as `Bearer <token>`.

  parameters:
    orgId:
      name: orgId
      in: path
      required: true
      description: The unique identifier of the organization.
      schema:
        type: string
        format: uuid
      example: "e8a7b5c2-93d1-4f6a-b2e0-1a4d5f8c9e3b"

    envId:
      name: envId
      in: path
      required: true
      description: The unique identifier of the environment.
      schema:
        type: string
        format: uuid
      example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

    instanceId:
      name: instanceId
      in: path
      required: true
      description: The numeric identifier of the API instance.
      schema:
        type: integer
      example: 19847562

    policyId:
      name: policyId
      in: path
      required: true
      description: The numeric identifier of the policy.
      schema:
        type: integer
      example: 982341

  schemas:
    CreateApiInstanceRequest:
      type: object
      required:
        - spec
        - endpoint
        - technology
      properties:
        spec:
          type: object
          description: The Exchange asset specification for the API.
          required:
            - groupId
            - assetId
            - version
          properties:
            groupId:
              type: string
              description: The group ID of the API asset in Exchange.
              example: "e8a7b5c2-93d1-4f6a-b2e0-1a4d5f8c9e3b"
            assetId:
              type: string
              description: The asset ID of the API in Exchange.
              example: "customer-api"
            version:
              type: string
              description: The version of the API asset.
              example: "1.0.0"
        endpoint:
          $ref: "#/components/schemas/Endpoint"
        technology:
          type: string
          description: The runtime technology for the API instance.
          enum:
            - mule4
            - mule3
            - flexGateway
          example: "mule4"
        instanceLabel:
          type: string
          description: A human-readable label for the API instance.
          example: "Customer API v1 - Production"

    Endpoint:
      type: object
      description: The endpoint configuration for the API instance.
      required:
        - type
        - uri
      properties:
        type:
          type: string
          description: The type of API specification.
          enum:
            - raml
            - http
            - wsdl
          example: "http"
        uri:
          type: string
          format: uri
          description: The implementation URI (backend service URL).
          example: "https://backend.example.com/api/v1"
        proxyUri:
          type: string
          format: uri
          description: The consumer-facing proxy URI.
          example: "https://proxy.example.com/customer/v1"
        isCloudHub:
          type: boolean
          description: Whether the endpoint is hosted on CloudHub.
          default: false
          example: false
        referencesUserDomain:
          type: boolean
          description: Whether the proxy references a user-defined domain.
          default: false
          example: false
        responseTimeout:
          type: integer
          description: The response timeout in milliseconds.
          minimum: 1000
          maximum: 300000
          default: 15000
          example: 15000

    ApiInstance:
      type: object
      properties:
        id:
          type: integer
          description: The unique numeric identifier of the API instance.
          example: 19847562
        instanceLabel:
          type: string
          description: A human-readable label for the API instance.
          example: "Customer API v1 - Production"
        technology:
          type: string
          description: The runtime technology for the API instance.
          enum:
            - mule4
            - mule3
            - flexGateway
          example: "mule4"
        assetId:
          type: string
          description: The asset ID of the API in Exchange.
          example: "customer-api"
        assetVersion:
          type: string
          description: The version of the API asset.
          example: "1.0.0"
        productVersion:
          type: string
          description: The product version identifier.
          example: "v1"
        environmentId:
          type: string
          format: uuid
          description: The environment where this instance is deployed.
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        endpoint:
          $ref: "#/components/schemas/Endpoint"
        status:
          type: string
          description: The current status of the API instance.
          enum:
            - unregistered
            - active
            - inactive
            - deprecated
          example: "unregistered"

    ApiInstanceListItem:
      type: object
      properties:
        id:
          type: integer
          description: The unique numeric identifier of the API instance.
          example: 19847562
        instanceLabel:
          type: string
          description: A human-readable label for the API instance.
          example: "Customer API v1 - Production"
        assetId:
          type: string
          description: The asset ID of the API in Exchange.
          example: "customer-api"
        assetVersion:
          type: string
          description: The version of the API asset.
          example: "1.0.0"
        technology:
          type: string
          description: The runtime technology for the API instance.
          enum:
            - mule4
            - mule3
            - flexGateway
          example: "mule4"
        status:
          type: string
          description: The current status of the API instance.
          enum:
            - unregistered
            - active
            - inactive
            - deprecated
          example: "active"

    ApiInstanceList:
      type: object
      properties:
        assets:
          type: array
          description: The list of API instances matching the query.
          items:
            $ref: "#/components/schemas/ApiInstanceListItem"
        total:
          type: integer
          description: The total number of API instances matching the query.
          example: 3

    DeployProxyRequest:
      type: object
      required:
        - type
        - gatewayVersion
        - targetId
        - environmentId
      properties:
        type:
          type: string
          description: |
            The deployment target type. `HY` for Hybrid (on-premises) runtimes,
            `CH` for CloudHub.
          enum:
            - HY
            - CH
          example: "CH"
        gatewayVersion:
          type: string
          description: The Mule runtime or Flex Gateway version to deploy.
          example: "4.6.0"
        targetId:
          type: string
          description: The unique identifier of the deployment target (server, server group, or cluster).
          example: "d4e5f6a7-b8c9-0123-d456-e7f8a9b0c1d2"
        environmentId:
          type: string
          format: uuid
          description: The environment ID where the proxy will be deployed.
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"

    Deployment:
      type: object
      properties:
        id:
          type: integer
          description: The unique numeric identifier of the deployment.
          example: 3048751
        type:
          type: string
          description: The deployment target type.
          enum:
            - HY
            - CH
          example: "CH"
        gatewayVersion:
          type: string
          description: The Mule runtime or Flex Gateway version deployed.
          example: "4.6.0"
        targetId:
          type: string
          description: The unique identifier of the deployment target.
          example: "d4e5f6a7-b8c9-0123-d456-e7f8a9b0c1d2"
        environmentId:
          type: string
          format: uuid
          description: The environment ID where the proxy is deployed.
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        applicationName:
          type: string
          description: The auto-generated application name for the deployed proxy.
          example: "customer-api-v1-proxy"
        status:
          type: string
          description: The current status of the deployment.
          enum:
            - deploying
            - deployed
            - undeploying
            - failed
          example: "deploying"
        updatedDate:
          type: string
          format: date-time
          description: The timestamp of the last deployment update.
          example: "2026-02-27T14:30:00.000Z"

    ApplyPolicyRequest:
      type: object
      required:
        - configurationData
        - assetId
        - assetVersion
        - groupId
      properties:
        configurationData:
          type: object
          description: |
            The policy-specific configuration. The structure depends on
            the policy type being applied.
          additionalProperties: true
          example:
            rateLimits:
              - maximumRequests: 100
                timePeriodInMilliseconds: 60000
            clusterizable: true
            exposeHeaders: true
        pointcutData:
          description: |
            Optional pointcut configuration to restrict the policy to specific
            resource paths or methods. Set to `null` to apply the policy to
            all resources.
          nullable: true
          oneOf:
            - type: object
              properties:
                methodRegex:
                  type: string
                  description: Regular expression to match HTTP methods.
                  example: "GET|POST"
                uriTemplateRegex:
                  type: string
                  description: Regular expression to match URI templates.
                  example: "/api/v1/customers.*"
              additionalProperties: true
            - type: "null"
          example: null
        assetId:
          type: string
          description: The policy asset ID in Exchange.
          example: "rate-limiting"
        assetVersion:
          type: string
          description: The version of the policy asset.
          example: "1.4.0"
        groupId:
          type: string
          description: The group ID of the policy asset in Exchange.
          example: "68ef9520-24e9-4cf2-b2f5-620025690913"

    Policy:
      type: object
      properties:
        id:
          type: integer
          description: The unique numeric identifier of the applied policy.
          example: 982341
        assetId:
          type: string
          description: The policy asset ID in Exchange.
          example: "rate-limiting"
        assetVersion:
          type: string
          description: The version of the policy asset.
          example: "1.4.0"
        configurationData:
          type: object
          description: The policy-specific configuration data.
          additionalProperties: true
          example:
            rateLimits:
              - maximumRequests: 100
                timePeriodInMilliseconds: 60000
            clusterizable: true
            exposeHeaders: true
        order:
          type: integer
          description: The execution order of the policy. Lower numbers execute first.
          example: 1
        disabled:
          type: boolean
          description: Whether the policy is currently disabled.
          example: false

    PolicyList:
      type: object
      properties:
        policies:
          type: array
          description: The list of policies applied to the API instance.
          items:
            $ref: "#/components/schemas/Policy"

    Error:
      type: object
      properties:
        status:
          type: integer
          description: The HTTP status code.
          example: 400
        title:
          type: string
          description: A short summary of the error.
          example: "Bad Request"
        detail:
          type: string
          description: A human-readable explanation of the error.
          example: "The request body is missing required field 'spec.assetId'."

  responses:
    BadRequest:
      description: Bad request. The request body or parameters are invalid.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            status: 400
            title: "Bad Request"
            detail: "The request body is missing required field 'spec.assetId'."

    Unauthorized:
      description: Unauthorized. The bearer token is missing, expired, or invalid.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            status: 401
            title: "Unauthorized"
            detail: "The provided access token is expired or invalid."

    Forbidden:
      description: Forbidden. The authenticated user lacks the required permissions.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            status: 403
            title: "Forbidden"
            detail: "You do not have the 'Manage APIs Configuration' permission in this environment."

    NotFound:
      description: Not found. The specified resource does not exist.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            status: 404
            title: "Not Found"
            detail: "API instance with ID '19847562' was not found in the specified environment."
